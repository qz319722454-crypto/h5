<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>在线客服</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <style>
        body {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
        }
        .login-container {
            width: 100%;
            max-width: 400px;
        }
    </style>
</head>
<body class="bg-light">
    <div id="app" class="login-container">
        <div class="card shadow">
            <div class="card-body p-4">
                <h1 class="card-title text-center mb-4">在线客服</h1>
                <div v-if="error" class="alert alert-danger">{{ error }}</div>
                <input v-model="name" placeholder="用户名" class="form-control mb-3">
                <input type="password" v-model="password" placeholder="密码" class="form-control mb-3">
                <button @click="login" class="btn btn-primary w-100" :disabled="loading">
                    {{ loading ? '登录中...' : '登录' }}
                </button>
            </div>
        </div>
    </div>

    <script>
        const { createApp } = Vue;
        createApp({
            data() {
                return {
                    name: '',
                    password: '',
                    error: '',
                    loading: false
                };
            },
            methods: {
                async login() {
                    if (!this.name || !this.password) {
                        this.error = '请输入用户名和密码';
                        return;
                    }
                    this.error = '';
                    this.loading = true;
                    try {
                        const response = await fetch('https://kefu.chacaitx.cn/api/admin/login', {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({ Name: this.name, Password: this.password })
                        });
                        
                        if (!response.ok) {
                            const errorData = await response.json().catch(() => ({ error: '登录失败' }));
                            this.error = errorData.error || `登录失败 (${response.status})`;
                            return;
                        }
                        
                        const data = await response.json();
                        if (data.csId || data.isAdmin) {
                            // 保存登录状态
                            if (data.isAdmin) {
                                localStorage.setItem('isAdmin', 'true');
                                localStorage.setItem('adminCsId', data.csId.toString());
                                window.location.href = '/admin/';
                            } else {
                                localStorage.setItem('isAdmin', 'false');
                                localStorage.setItem('csId', data.csId.toString());
                                localStorage.setItem('csName', this.name);
                                window.location.href = '/cs/';
                            }
                        } else {
                            this.error = data.error || '登录失败，请检查用户名和密码';
                        }
                    } catch (err) {
                        this.error = '网络错误: ' + err.message;
                        console.error('Login error:', err);
                    } finally {
                        this.loading = false;
                    }
                }
            }
        }).mount('#app');
    </script>
</body>
</html>
